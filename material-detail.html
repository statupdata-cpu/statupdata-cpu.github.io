<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Material Viewer — STATUP</title>
<meta name="description" content="STATUP materials viewer — books, PYQs, mock tests, playlists and files for UGC NET Paper 2 (Population Studies)." />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  /* ---- Base / theme ---- */
  :root{
    --bg:#f6fbfb;
    --surface:#ffffff;
    --muted:#6b7a83;
    --text:#073b4c;
    --accent1:#0e9ea4;
    --accent2:#39b893;
    --shadow: 0 14px 40px rgba(12,45,47,0.06);
    --card-radius:14px;
    --gap:18px;
    --max-w:1100px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased}
  a { color:var(--accent1); text-decoration:none }
  a:focus { outline:3px solid rgba(14,158,164,0.12); outline-offset:3px; border-radius:6px; }
  .wrap{max-width:var(--max-w);margin:0 auto;padding:28px}
  .small{font-size:13px;color:var(--muted)}
  .muted{color:var(--muted)}

  /* ---- Header ---- */
  header{background:linear-gradient(180deg,#fbfffe,#f6fbfb);border-bottom:1px solid rgba(10,40,50,0.03)}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand strong{font-weight:700;font-size:18px;letter-spacing:0.2px}
  nav a{margin-left:16px;font-weight:600;color:rgba(8,40,45,0.75)}
  nav a:hover{color:var(--text)}

  /* ---- Breadcrumb / hero ---- */
  .breadcrumb{font-size:13px;color:var(--muted);margin:18px 0}
  .viewer-hero{display:flex;gap:24px;align-items:flex-start;flex-wrap:wrap;padding:20px;border-radius:var(--card-radius);background:linear-gradient(180deg,#ffffff, #f8fbfb);box-shadow:var(--shadow)}
  .cover{width:340px;min-width:200px;border-radius:12px;overflow:hidden;background:#f2f8f7;box-shadow:0 10px 30px rgba(12,45,47,0.04)}
  .cover img{display:block;width:100%;height:100%;min-height:180px;object-fit:cover}
  .meta{flex:1;min-width:260px}
  .meta h1{margin:0;font-size:24px}
  .meta .meta-sub{margin-top:8px;color:var(--muted)}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}

  /* ---- Buttons ---- */
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;font-size:14px}
  .btn:focus{outline:3px solid rgba(14,158,164,0.12);outline-offset:3px}
  .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;box-shadow:0 10px 32px rgba(14,165,164,0.08)}
  .btn.ghost{background:#fff;border:1px solid rgba(10,40,50,0.06);color:var(--text)}
  .btn.link-like{background:transparent;color:var(--accent1);font-weight:600;padding:8px 10px;border-radius:8px}

  /* ---- extra meta / badge ---- */
  .badge-free{display:inline-block;background:#16a34a;color:#fff;padding:6px 10px;border-radius:999px;font-weight:800;font-size:12px}
  .tags{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .tag{background:#eef8f6;padding:6px 8px;border-radius:999px;font-size:13px;color:var(--accent1);font-weight:700}

  /* ---- related gallery ---- */
  .gallery{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
  .item-card{background:var(--surface);padding:12px;border-radius:12px;box-shadow:0 8px 26px rgba(12,45,47,0.04);display:flex;flex-direction:column;min-height:200px}
  .item-thumb{height:120px;border-radius:8px;overflow:hidden;background:#eef7f5;display:flex;align-items:center;justify-content:center}
  .item-thumb img{width:100%;height:100%;object-fit:cover}
  .item-title{font-weight:700;margin:10px 0 6px 0;color:var(--text);font-size:15px}
  .item-desc{color:var(--muted);font-size:13px;flex:1}

  /* ---- modal (preview player/pdf) ---- */
  .modal-backdrop{position:fixed;inset:0;background:rgba(6,12,12,0.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:9999}
  .modal{background:var(--surface);width:min(1100px,96%);border-radius:12px;padding:12px;box-shadow:0 30px 80px rgba(4,12,12,0.5)}
  .modal iframe{width:100%;height:560px;border-radius:8px;border:0}
  .modal .modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .close-x{background:transparent;border:0;font-size:16px;padding:8px;cursor:pointer}

  /* ---- responsive tweaks ---- */
  @media (max-width:980px){
    .cover{width:280px}
  }
  @media (max-width:820px){
    .viewer-hero{flex-direction:column}
    .cover{width:100%}
    .meta{width:100%}
  }
</style>
</head>
<body>
  <header>
    <div class="wrap topbar" role="banner">
      <div class="brand" aria-label="STATUP brand">
        <img src="logo.png" alt="STATUP logo" style="height:44px" onerror="this.style.display='none'">
        <div>
          <strong>STATUP</strong><br><span class="small">Materials viewer</span>
        </div>
      </div>
      <nav aria-label="Primary navigation">
        <a href="materials.html">All materials</a> ·
        <a href="services.html">Services</a> ·
        <a href="index.html">Home</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="main">
    <div class="breadcrumb" id="breadcrumb"><a href="materials.html">Materials</a> › <span id="bcTitle">Loading…</span></div>

    <section class="viewer-hero" aria-labelledby="title" role="region">
      <aside class="cover" id="coverWrap" aria-hidden="false">
        <img id="coverImg" src="files/covers/placeholder-cover.png" alt="cover image">
      </aside>

      <div class="meta">
        <h1 id="title">Loading…</h1>
        <div id="yearAndType" class="meta-sub small"></div>
        <p id="desc" class="muted" style="margin-top:12px"></p>

        <div class="actions" aria-label="Material actions">
          <a id="openLink" class="btn primary" target="_blank" rel="noopener">Open (file)</a>
          <button id="previewBtn" class="btn ghost" style="display:none">Preview</button>
          <a id="downloadBtn" class="btn ghost" style="display:none" download>Download</a>
          <a href="materials.html" class="btn link-like" title="Return to All materials">Back to materials</a>
        </div>

        <div id="extraMeta" style="margin-top:12px" class="small"></div>
      </div>
    </section>

    <section aria-labelledby="sectionTitle">
      <h3 id="sectionTitle" style="margin-top:18px">Related items</h3>
      <div id="gallery" class="gallery" aria-live="polite"></div>
    </section>
  </main>

  <!-- preview modal -->
  <div id="modal" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Preview">
    <div class="modal" role="document">
      <div class="modal-head">
        <div id="modalTitle" style="font-weight:700"></div>
        <div>
          <button id="modalClose" class="close-x" aria-label="Close preview">✕</button>
        </div>
      </div>
      <div id="modalBody" style="min-height:80px"></div>
    </div>
  </div>

<script>
/* ========== your items array ========== 
   Replace the sample items below with your real items or include shared JS.
*/
const items = [
  { id: 'book-1', title: 'Population Studies — Intro', year: 2017, tags:['book','pdf'], type: 'book', link: 'files/book-population.pdf', desc:'A public-domain book covering basic demographic methods.', free:true },
  { id: 'book-2', title: 'PyQ Papers Collection', year: null, tags:['book','zip'], type: 'book', link: 'files/solved-collection.zip', desc:'Collection of solved PYQs (zip).', free:true },
  { id: 'pyq-2019-jun', title: 'UGC NET Paper 2 — PYQ 2019 June', year: 2019, tags:['pyq','2019'], type: 'pyq', link: 'files/pyq-2019.pdf', desc: 'Complete paper for 2019 June (Population Studies).', free:true },
  { id: 'yt-populations', title: 'Population Studies — YouTube Playlist', year: null, tags:['video','playlist'], type:'video', link:'https://youtu.be/GWdSSIhgF-8?si=HKP3R5iaCqlmFFhk', desc:'Public playlist covering important topics.'}
];

/* ======= Utility: read id from hash ======= */
function idFromHash(){ return location.hash ? location.hash.slice(1) : null; }

/* ======= Render viewer for item id ======= */
(function initViewer(){
  const id = idFromHash();
  const titleEl = document.getElementById('title');
  const descEl = document.getElementById('desc');
  const yearTypeEl = document.getElementById('yearAndType');
  const bcTitle = document.getElementById('bcTitle');
  const openLink = document.getElementById('openLink');
  const previewBtn = document.getElementById('previewBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const coverImg = document.getElementById('coverImg');
  const extraMeta = document.getElementById('extraMeta');
  const gallery = document.getElementById('gallery');

  if (!id) {
    titleEl.textContent = 'No material selected';
    descEl.textContent = 'Open an item from the Materials page to view details here.';
    openLink.style.display = 'none';
    previewBtn.style.display = 'none';
    downloadBtn.style.display = 'none';
    return;
  }

  const item = items.find(it => it.id === id);
  if (!item) {
    titleEl.textContent = 'Material not found';
    descEl.textContent = 'The requested material ID was not found. Try the materials list.';
    openLink.style.display = 'none';
    previewBtn.style.display = 'none';
    downloadBtn.style.display = 'none';
    return;
  }

  // metadata
  bcTitle.textContent = item.title;
  titleEl.textContent = item.title;
  yearTypeEl.textContent = (item.year ? item.year + ' · ' : '') + (item.type ? item.type.toUpperCase() : '');
  descEl.textContent = item.desc || '';

  // cover: try typical extensions; fallback via onerror
  const trySrcs = [
    `files/covers/${item.id}.jpg`,
    `files/covers/${item.id}.png`,
    `files/covers/${item.id}.webp`,
    `files/covers/${item.id}.jpeg`
  ];
  // pick first candidate and let onerror fallback
  coverImg.src = trySrcs[0];
  coverImg.alt = item.title;
  coverImg.onerror = () => {
    // try next (rotating through list)
    for (let i = 1; i < trySrcs.length; i++){
      const s = trySrcs[i];
      // if the img already tried this src, skip; assign and break
      if (coverImg.src.indexOf(s) === -1) { coverImg.src = s; return; }
    }
    // final fallback
    coverImg.src = 'files/covers/placeholder-cover.png';
  };

  // action buttons
  openLink.href = item.link || '#';
  openLink.style.display = 'inline-flex';
  // decide preview/download availability
  previewBtn.style.display = 'none';
  downloadBtn.style.display = 'none';
  if (item.type === 'video') {
    previewBtn.style.display = 'inline-flex';
    previewBtn.textContent = 'Preview video';
    previewBtn.onclick = () => openVideoModal(item.link, item.title);
    openLink.target = '_blank';
    openLink.textContent = 'Open video/playlist';
  } else if (item.link && (item.link.endsWith('.pdf') || item.link.includes('.pdf'))) {
    previewBtn.style.display = 'inline-flex';
    previewBtn.textContent = 'Preview PDF';
    previewBtn.onclick = () => openPdfModal(item.link, item.title);
    downloadBtn.style.display = 'inline-flex';
    downloadBtn.href = item.link;
    downloadBtn.textContent = 'Download PDF';
    openLink.textContent = 'Open file';
  } else {
    openLink.textContent = 'Open (resource)';
    openLink.target = '_blank';
  }

  // extra meta / tags / free badge
  extraMeta.innerHTML = '';
  if (item.tags && item.tags.length) {
    extraMeta.innerHTML += `<div class="small">Tags: ${item.tags.join(', ')}</div>`;
  }
  if (item.free) {
    extraMeta.innerHTML += `<div style="margin-top:8px"><span class="badge-free" aria-hidden="true">FREE</span></div>`;
  }

  // build related gallery (same type or share tags)
  const related = items.filter(it => it.id !== item.id && (it.type === item.type || (it.tags && item.tags && it.tags.some(t => item.tags && item.tags.includes(t))))).slice(0,12);
  gallery.innerHTML = related.length ? '' : '<div class="small">No related items.</div>';
  related.forEach(r => {
    const card = document.createElement('article');
    card.className = 'item-card';
    const thumb = document.createElement('div');
    thumb.className = 'item-thumb';
    const img = document.createElement('img');
    img.alt = r.title;
    img.src = `files/covers/${r.id}.jpg`;
    img.onerror = () => { img.src = 'files/covers/placeholder-thumb.png'; };
    thumb.appendChild(img);

    const title = document.createElement('div');
    title.className = 'item-title';
    title.innerHTML = `${r.title} ${r.free ? '<span class="badge-free" style="font-size:11px">FREE</span>' : ''}`;

    const desc = document.createElement('div');
    desc.className = 'item-desc';
    desc.textContent = r.desc || '';

    const btnRow = document.createElement('div');
    btnRow.style.marginTop = '10px';
    btnRow.innerHTML = `<a class="btn primary" href="material-detail.html#${encodeURIComponent(r.id)}">Open</a> <a class="btn ghost" href="${r.link}" target="_blank" rel="noopener">Open resource</a>`;

    card.appendChild(thumb);
    card.appendChild(title);
    card.appendChild(desc);
    card.appendChild(btnRow);
    gallery.appendChild(card);
  });
})(); // initViewer end

/* ======= Modal helpers ======= */
const modal = document.getElementById('modal');
const modalBody = document.getElementById('modalBody');
const modalClose = document.getElementById('modalClose');
const modalTitle = document.getElementById('modalTitle');

modalClose.addEventListener('click', closeModal);
modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

function openPdfModal(url, title = '') {
  modalTitle.textContent = title || 'Preview';
  // embed pdf via iframe (works for public PDFs)
  modalBody.innerHTML = `<iframe src="${url}"></iframe>`;
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');
}

function openVideoModal(yurl, title = '') {
  modalTitle.textContent = title || 'Video';
  let embed = '';
  if (yurl.includes('youtube.com/playlist') || yurl.includes('list=')) {
    const m = yurl.match(/list=([A-Za-z0-9_-]+)/);
    if (m) embed = `https://www.youtube.com/embed/videoseries?list=${m[1]}`;
  } else {
    const vid = (yurl.match(/v=([A-Za-z0-9_-]+)/) || yurl.match(/youtu\\.be\\/([A-Za-z0-9_-]+)/) || [])[1];
    if (vid) embed = `https://www.youtube.com/embed/${vid}?rel=0`;
  }
  if (!embed) {
    window.open(yurl, '_blank');
    return;
  }
  modalBody.innerHTML = `<iframe src="${embed}" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>`;
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');
}

function closeModal() {
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden', 'true');
  modalBody.innerHTML = '';
  modalTitle.textContent = '';
}

/* Reload viewer on anchor changes (deep-link support) */
window.addEventListener('hashchange', ()=> location.reload());
</script>
</body>
</html>
